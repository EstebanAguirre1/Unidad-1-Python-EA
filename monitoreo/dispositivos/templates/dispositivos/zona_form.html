{% extends "base.html" %}
{% load static %}

{% block title %}{{ accion }} Zona{% endblock %}

{% block content %}
<div class="container mt-3">
    <h3>{{ accion }} Zona</h3>

    <form method="post" id="zonaForm" novalidate>
        {% csrf_token %}

        <!-- Nombre de la zona -->
        <div class="mb-3">
            {{ form.name.label_tag }}
            {{ form.name }}
            {% if form.name.errors %}
            <div class="text-danger">
                {% for error in form.name.errors %}
                    {{ error }}
                {% endfor %}
            </div>
            {% endif %}
        </div>

        <!-- Organización -->
        <div class="mb-3">
            {{ form.organization.label_tag }}
            {{ form.organization }}
            {% if form.organization.errors %}
            <div class="text-danger">
                {% for error in form.organization.errors %}
                    {{ error }}
                {% endfor %}
            </div>
            {% endif %}
        </div>

        <button class="btn btn-success" type="submit">Guardar</button>
        <a href="{% url 'zona_list' %}" class="btn btn-secondary">Cancelar</a>
    </form>
</div>
{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
document.addEventListener("DOMContentLoaded", function() {
    const form = document.getElementById("zonaForm");

    form.addEventListener("submit", function(ev) {
        // Validación simple de organización
        const orgSelect = form.querySelector("#id_organization");
        if (!orgSelect.value) {
            ev.preventDefault(); // Detiene el submit
            Swal.fire({
                icon: "error",
                title: "Debe seleccionar una organización",
                text: "Por favor elija una organización antes de guardar.",
            });
            return false;
        }
    });

    // Mostrar alertas del backend (mensajes de Django)
    {% if messages %}
        {% for message in messages %}
            Swal.fire({
                icon: "{% if message.tags == 'error' %}error{% elif message.tags == 'success' %}success{% else %}info{% endif %}",
                title: "{{ message }}",
                timer: 2000,
                showConfirmButton: false
            });
        {% endfor %}
    {% endif %}
});
</script>
{% endblock %}
